#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <mysql/mysql.h>
#include <unistd.h>

#include "defines.h"

#define fflush(stdin) while ((getchar()) != '\n')
#define true 1
#define false 0

MYSQL *conn;
MYSQL *login;
char u[255];
char p[255];
char c;
int cmd1 = 0;
int cmd2 = 0;
int num_fields;
MYSQL_RES *result;
MYSQL_ROW row;
MYSQL_FIELD *field;
char CF_I[17];
char NOME_PISCINA_ADDETTO[50];
char query[255];




// ************************ UTILS ******************************

void finish_with_error(MYSQL *con, char *err) {
	fprintf(stderr, "%s error: %s\n", err, mysql_error(con));
	mysql_close(con);
	exit(1);
}



void input_wait() {
	fflush(stdin);
	char c;
	printf("\nINFO: Premi invio per continuare: \n");
	while (c = getchar() != '\n'){}
}



MYSQL_RES* get_result_from_sql_query(char *query){
	printf("QUERY: %s \n",query);
	mysql_query (conn,query);
	result = mysql_store_result(conn);

	if (result == NULL){
		finish_with_error(conn, "errore");
	}

	MYSQL_RES *res;
	res = result;
	
	mysql_free_result(result);
	mysql_next_result(conn);
	input_wait();
	return res;
}




void print_sql_query(char *query){
	printf("QUERY: %s \n",query);
	mysql_query (conn,query);
	result = mysql_store_result(conn);

	if (result == NULL){
		finish_with_error(conn, "errore");
	}
	num_fields = mysql_num_fields(result);
	printf ("\n");
	while ((row = mysql_fetch_row(result))){
		for(int i = 0; i < num_fields; i++) {
			if (i == 0) {
				while(field = mysql_fetch_field(result)){ //include il nome della colonna nella stampa
					printf( "| %s ", field->name);
				}
				printf ("\n");
			}
			printf(" %s ", row[i] ? row[i] : "NULL");
		}
	}
	printf("\n");
	mysql_free_result(result);
	mysql_next_result(conn);
	input_wait();
}


void run_sql_query (char *query) {
	printf("QUERY: %s \n",query);
	if(mysql_query(conn,query)) {
		finish_with_error(conn, "Query");
	} else {
		printf ("INFO: Operazione completata.");
		input_wait();
	}
}

// ************************ INSEGNANTE ******************************

int is_CF_insegnante_valid(char* CodFisc_I){
	MYSQL_RES* res;
	snprintf(query, 1000, "CALL is_CF_insegnante_valid('%s');",CodFisc_I);

	res = get_result_from_sql_query(query);
	row = mysql_fetch_row(res);
	// verifico dal return di della procedure EXIST
	// return 1: esiste il codice fiscale insegnante
	// return 0: il codice fiscale non corrisponde ad un insegnante
	printf("RETURN: %s\n",row[0]);
	if (strcmp(row[0], "1") == 0){ // se esiste il codice fiscale...
		return 1;
	}
	return 0;
}



void insegnante_logged(){
	printf("\n######################################\n");
	printf("INFO: Accesso eseguito come insegnante.\n\n");
	printf("> Inserisci il tuo codice fiscale per continuare: ");
	scanf ("%s",CF_I);
	printf("\n");

	if(is_CF_insegnante_valid(CF_I)){
		printf("INFO: Accesso eseguito per l'insegnante %s\n",CF_I);

		while(true){
			printf("\n##################################################\n");
			printf(" Lista funzioni eseguibili dall'utente insegnante %s:\n",CF_I);
			printf("##################################################\n\n");
			printf("  1) Esegui report di lavoro settimanale (7  giorni dalla data inserita)\n");
			printf("  2) Esegui report di lavoro mensile     (31 giorni dalla data inserita)\n");
			printf("  99) Termina\n\n");
			printf("> Inserisci un Comando: ");
			scanf ("%i",&cmd2);

			char inizio[11];

			if(cmd2 == 1){
				printf("\n> Inserisci la data di inizio del report settimanale [AAAA-MM-GG]: ");
				scanf ("%s",inizio);
				snprintf(query, 1000, "call report_insegnante('%s','%d','%s');",inizio,7,CF_I);
				print_sql_query(query);

			}else if(cmd2 == 2){
				printf("\n> Inserisci la data di inizio del report mensile [AAAA-MM-GG]: ");
				scanf ("%s",inizio);
				snprintf(query, 1000, "call report_insegnante('%s','%d','%s');",inizio,31,CF_I);
				print_sql_query(query);

			}else if(cmd2 == 99){
				printf("\nINFO: Uscita...Bye\n");
				break;
			}

		}
	} else printf("ERROR: Codice fiscale non valido\n");
}

// ************************ ADDETTO SEGRETERIA ******************************


/*
void persona_inserisci(){
	char CF_P[17],indirizzo[50],nome[30];
	printf ("\nCodice fiscale della persona: ");
	scanf ("%s",CF_P);
	fflush(stdin);
	printf ("\nIndirizzo: ");
	scanf ("%[^\n]",indirizzo);
	fflush(stdin);
	printf ("\nNome: ");
	scanf ("%[^\n]",nome);
	fflush(stdin);

	snprintf(query, 1000, "\ncall persona_inserisci('%s','%s','%s')", CF_P, indirizzo, nome);
	run_sql_query(query);

	
	printf("> Vuoi inserire i contatti (mail, cellulare, telefono)? s/n: ");
	char choice;
	scanf ("%c",&choice);
	fflush(stdin);
	if (choice == 's') {
		char mail[30],cellulare[20],telefono[20];

		printf ("\nMail: ");
		scanf ("%[^\n]",mail);
		fflush(stdin);
		printf ("\nCellulare: ");
		scanf ("%[^\n]",cellulare);
		fflush(stdin);
		printf ("\nTelefono: ");
		scanf ("%[^\n]",telefono);

		snprintf(query, 1000, "\ncall persona_inserisci_contatti('%s','%s','%s','%s')", 
						CF_P, mail, cellulare, telefono);
		run_sql_query(query);
	} 
}


void persona_modifica(){
	char CF_P[17],indirizzo[50],nome[30];
	printf ("\nCodice fiscale della persona da modificare: ");
	scanf ("%s",CF_P);
	fflush(stdin);

	printf ("\nNuovo indirizzo: ");
	scanf ("%[^\n]",indirizzo);
	fflush(stdin);
	printf ("\nNuovo nome: ");
	scanf ("%[^\n]",nome);
	fflush(stdin);
	
	snprintf(query, 1000, "\ncall persona_modifica('%s','%s','%s')", CF_P, indirizzo, nome);
	run_sql_query(query);

	printf("> Vuoi modificare i contatti (mail, cellulare, telefono)? s/n: ");
	char choice;
	scanf ("%c",&choice);
	fflush(stdin);
	if (choice == 's') {
		char mail[30],cellulare[20],telefono[20];

		printf ("\nMail: ");
		scanf ("%[^\n]",mail);
		fflush(stdin);
		printf ("\nCellulare: ");
		scanf ("%[^\n]",cellulare);
		fflush(stdin);
		printf ("\nTelefono: ");
		scanf ("%[^\n]",telefono);

		snprintf(query, 1000, "\ncall persona_modifica_contatti('%s','%s','%s','%s')", 
						CF_P, mail, cellulare, telefono);
		run_sql_query(query);
	} 
}

void persona_elimina(){
	//TODO ON DELETE CASCADE?
	char CF_P[17];
	printf ("\nCodice fiscale della persona da eliminare: ");
	scanf ("%s",CF_P);
	fflush(stdin);
	
	snprintf(query, 1000, "\ncall persona_elimina('%s')", CF_P);
	run_sql_query(query);
}

void persona_effettua_ingresso_libero(){
	char CF_P[17],data_ingresso[11],nome_piscina[50];

	printf ("\nCodice fiscale della persona: ");
	scanf ("%s",CF_P);
	fflush(stdin);

	printf ("\nData ingresso : ");
	scanf ("%[^\n]",data_ingresso);
	fflush(stdin);


	snprintf(query, 1000, "\ncall persona_effettua_ingresso_libero('%s','%s','%s')",
					 CF_P, data_ingresso, NOME_PISCINA_ADDETTO);
	run_sql_query(query);
}

void persona_inserisci_iscritta_corsi(){
	char CF_P[17],medico[30],data_certificato[11],data_nascita[11];

	printf ("\nCodice fiscale della persona: ");
	scanf ("%s",CF_P);
	fflush(stdin);

	printf ("\nMedico che ha redatto il certificato: ");
	scanf ("%[^\n]",medico);
	fflush(stdin);
	printf ("\nData certificato medico: ");
	scanf ("%[^\n]",data_certificato);
	fflush(stdin);
	printf ("\nData di nascita: ");
	scanf ("%[^\n]",data_nascita);


	snprintf(query, 1000, "\ncall persona_inserisci_iscritta_corsi('%s','%s','%s','%s')",
					 CF_P, medico, data_certificato, data_nascita);
	run_sql_query(query);

}

void persona_modifica_iscritta_corsi(){
	char CF_P[17],medico[30],data_certificato[11],data_nascita[11];

	printf ("\nCodice fiscale della persona iscritta ai corsi da modificare: ");
	scanf ("%s",CF_P);
	fflush(stdin);

	printf ("\nNuovo medico che ha redatto il certificato : ");
	scanf ("%[^\n]",medico);
	fflush(stdin);
	printf ("\nNuova data certificato medico: ");
	scanf ("%[^\n]",data_certificato);
	fflush(stdin);
	printf ("\nNuova data di nascita: ");
	scanf ("%[^\n]",data_nascita);


	snprintf(query, 1000, "\ncall persona_modifica_iscritta_corsi('%s','%s','%s','%s')",
					 CF_P, medico, data_certificato, data_nascita);
	run_sql_query(query);

}

void persona_elimina_iscritta_corsi(){
	//TODO ON DELETE CASCADE?
	char CF_P[17];
	printf ("\nCodice fiscale della persona iscritta ai corsi da eliminare:  ");
	scanf ("%s",CF_P);
	fflush(stdin);
	
	snprintf(query, 1000, "\ncall persona_elimina('%s')", CF_P);
	run_sql_query(query);
}

void persona_effettua_iscrizione_corso(){
	char CF_P[17],corso[30];

	printf ("\nCodice fiscale della persona: ");
	scanf ("%s",CF_P);
	fflush(stdin);

	printf ("\nCorso esistente presso %s: ",NOME_PISCINA_ADDETTO);
	scanf ("%[^\n]",corso);
	fflush(stdin);


	snprintf(query, 1000, "\ncall persona_effettua_iscrizione_corso('%s','%s','%s')",
					 CF_P, corso, NOME_PISCINA_ADDETTO);
	run_sql_query(query);
}

void persona_cancella_iscrizione_corso(){
	//TODO ON DELETE CASCADE?
	char CF_P[17],corso[30];
	printf ("\nCodice fiscale della persona cui si vuole cancellare l'iscrizione:  ");
	scanf ("%s",CF_P);
	fflush(stdin);

	printf ("\nCorso esistente per la quale si vuole cancellare l'iscrizione presso %s per la persona %s : ",NOME_PISCINA_ADDETTO, CF_P);
	scanf ("%[^\n]",corso);
	fflush(stdin);
	
	snprintf(query, 1000, "\ncall persona_cancella_iscrizione_corso('%s','%s','%s')", CF_P, corso, NOME_PISCINA_ADDETTO);
	run_sql_query(query);
}


void corso_inserisci(){
	char Nome_Corso[30];
	float costo;
	int massimo,minimo;

	printf ("\nNome del corso: ");
	scanf ("%[^\n]",Nome_Corso);
	fflush(stdin);

	printf ("\nCosto del corso: ");
	scanf ("%f",&costo);
	fflush(stdin);
	printf ("\nNumero massimo di partecipanti: ");
	scanf ("%i",&massimo);
	fflush(stdin);
	printf ("\nNumero minimo di partecipanti: ");
	scanf ("%i",&minimo);


	snprintf(query, 1000, "\ncall corso_inserisci('%s','%s','%f','%i','%i')",
					 Nome_Corso, NOME_PISCINA_ADDETTO, costo, massimo, minimo);
	run_sql_query(query);
}

void corso_modifica(){
	char Nome_Corso[30];
	float costo;
	int massimo,minimo;

	printf ("\nNome del corso da modificare presso %s: ",NOME_PISCINA_ADDETTO);
	scanf ("%s",Nome_Corso);
	fflush(stdin);

	printf ("\nNuovo costo del corso: ");
	scanf ("%f",&costo);
	fflush(stdin);
	printf ("\nNuovo numero massimo di partecipanti: ");
	scanf ("%i",&massimo);
	fflush(stdin);
	printf ("\nNuovo numero minimo di partecipanti: ");
	scanf ("%i",&minimo);


	snprintf(query, 1000, "\ncall corso_modifica('%s',%s','%f','%i','%i')",
					 Nome_Corso, NOME_PISCINA_ADDETTO, costo, massimo, minimo);
	run_sql_query(query);
}

void corso_elimina(){
	char Nome_Corso[30];

	printf ("\nNome del corso da eliminare presso %s: ",NOME_PISCINA_ADDETTO);
	scanf ("%s",Nome_Corso);
	fflush(stdin);


	snprintf(query, 1000, "\ncall corso_elimina('%s',%s')",
					 Nome_Corso, NOME_PISCINA_ADDETTO );
	run_sql_query(query);
}


void corso_inserisci_lezione(){
	char Nome_Corso[30],dalle[9],alle[9];
	int giorno;

	printf ("\nNome del corso esistente presso %s: ",NOME_PISCINA_ADDETTO);
	scanf ("%s",Nome_Corso);
	fflush(stdin);

	printf ("\nGiorno della settimana [1-7] (1:Domenica, 2:Lunedi, 3:Martedi, 4:Mercoledi, 5:Giovedi, 6:Venerdi, 7:Sabato) ");
	scanf ("%i",&giorno);
	fflush(stdin);
	printf ("\nOrario di inizio [HH:MM] : ");
	scanf ("%[^\n]",dalle);
	fflush(stdin);
	printf ("\nOrario di fine [HH:MM] : ");
	scanf ("%[^\n]",alle);


	snprintf(query, 1000, "\ncall corso_inserisci_lezione('%i','%s','%s','%s','%s')",
					 giorno, dalle, alle, Nome_Corso, NOME_PISCINA_ADDETTO);
	run_sql_query(query);
}

void corso_modifica_lezione(){
	char Nome_Corso[30],old_dalle[9],old_alle[9],new_dalle[9],new_alle[9];
	int giorno;

	printf ("\nNome del corso presso %s da modificare: ",NOME_PISCINA_ADDETTO);
	scanf ("%s",Nome_Corso);
	fflush(stdin);

	printf ("\nGiorno della settimana da modificare [1-7] (1:Domenica, 2:Lunedi, 3:Martedi, 4:Mercoledi, 5:Giovedi, 6:Venerdi, 7:Sabato) ");
	scanf ("%i",&giorno);
	fflush(stdin);
	printf ("\nOrario di inizio da modificare[HH:MM] : ");
	scanf ("%[^\n]",old_dalle);
	fflush(stdin);
	printf ("\nOrario di fine da modificare[HH:MM] : ");
	scanf ("%[^\n]",old_alle);
	printf ("\nNuovo orario di inizio[HH:MM] : ");
	scanf ("%[^\n]",new_dalle);
	fflush(stdin);
	printf ("\nNuovo orario di fine[HH:MM] : ");
	scanf ("%[^\n]",new_alle);


	snprintf(query, 1000, "\ncall corso_modifica_lezione('%i','%s','%s','%s','%s','%s','%s')",
					 giorno, old_dalle, old_alle, Nome_Corso, NOME_PISCINA_ADDETTO, new_dalle, new_alle);
	run_sql_query(query);
}


void corso_elimina_lezione(){
	char Nome_Corso[30],dalle[9],alle[9];
	int giorno;

	printf ("\nNome del corso esistente da eliminare presso %s: ",NOME_PISCINA_ADDETTO);
	scanf ("%s",Nome_Corso);
	fflush(stdin);

	printf ("\nGiorno della settimana del corso da eliminare [1-7] (1:Domenica, 2:Lunedi, 3:Martedi, 4:Mercoledi, 5:Giovedi, 6:Venerdi, 7:Sabato) ");
	scanf ("%i",&giorno);
	fflush(stdin);
	printf ("\nOrario di inizio del corso da eliminare [HH:MM] : ");
	scanf ("%[^\n]",dalle);
	fflush(stdin);
	printf ("\nOrario di fine del corso da eliminare [HH:MM] : ");
	scanf ("%[^\n]",alle);


	snprintf(query, 1000, "\ncall corso_elimina_lezione('%i','%s','%s','%s','%s')",
					 giorno, dalle, alle, Nome_Corso, NOME_PISCINA_ADDETTO);
	run_sql_query(query);
}


int is_piscina_addetto_valid(char* piscina){
	MYSQL_RES* res;
	snprintf(query, 1000, "CALL is_piscina_addetto_valid('%s');",piscina);

	res = get_result_from_sql_query(query);
	row = mysql_fetch_row(res);
	// verifico dal return di della procedure EXIST
	// return 1: esiste la piscina
	printf("RETURN: %s\n",row[0]);
	if (strcmp(row[0], "1") == 0){ // se esiste la piscina...
		return 1;
	}
	return 0;
}
*/

void addetto_segreteria_logged(){
	printf("\n######################################\n");
	printf("INFO: Accesso eseguito come addetto segreteria.\n\n");
	printf("> Inserisci il nome della piscina presso cui lavori: ");
	scanf ("%s",NOME_PISCINA_ADDETTO);
	printf("\n");

	if(is_piscina_addetto_valid(NOME_PISCINA_ADDETTO)){
		printf("INFO: Accesso eseguito per l'addetto alla segreteria, presso %s\n",NOME_PISCINA_ADDETTO);

		while(true){
			printf("\n#########################################################\n");
			printf(" Lista funzioni eseguibili dall'utente addetto segreteria :\n");
			printf("##########################################################\n\n");
			printf("  1) Inserisci persona\n");
			printf("  2) Modifica persona\n");
			printf("  3) Elimina persona\n\n");
			printf("  4) Effettua ingresso libero presso %s\n\n",NOME_PISCINA_ADDETTO);
			printf("  5) Inserisci iscritto ai corsi presso %s\n",NOME_PISCINA_ADDETTO);
			printf("  6) Modifica iscritto ai corsi presso %s\n",NOME_PISCINA_ADDETTO);
			printf("  7) Elimina iscritto ai corsi presso %s\n\n",NOME_PISCINA_ADDETTO);

			printf("  8) Effettua iscrizione ad un corso presso %s\n",NOME_PISCINA_ADDETTO);
			printf("  9) Cancella iscrizione ad un corso presso %s\n\n",NOME_PISCINA_ADDETTO);

			printf("  10) Inserisci corso presso %s\n",NOME_PISCINA_ADDETTO);
			printf("  11) Modifica corso presso %s\n",NOME_PISCINA_ADDETTO);
			printf("  12) Elimina corso presso %s\n\n",NOME_PISCINA_ADDETTO);

			printf("  13) Inserisci lezione di un corso presso %s\n",NOME_PISCINA_ADDETTO);
			printf("  14) Modifica lezione di un corso presso %s\n",NOME_PISCINA_ADDETTO);
			printf("  15) Elimina lezione di un corso presso %s\n\n",NOME_PISCINA_ADDETTO);

			printf("  99) Termina\n\n");
			printf("> Inserisci un Comando: ");
			scanf ("%i",&cmd2);
			fflush(stdin);

			switch(cmd2){
				case 1:
					persona_inserisci();
					break;
				case 2:
					persona_modifica();
					break;
				case 3:
					persona_elimina();
					break;
				case 4:
					persona_effettua_ingresso_libero();
					break;
				case 5:
					persona_inserisci_iscritta_corsi();
					break;
				case 6:
					persona_modifica_iscritta_corsi();
					break;
				case 7:
					persona_elimina_iscritta_corsi();
					break;
				case 8:
					persona_effettua_iscrizione_corso();
					break;
				case 9:
					persona_cancella_iscrizione_corso();
					break;
				case 10:
					corso_inserisci();
					break;
				case 11:
					corso_modifica();
					break;
				case 12:
					corso_elimina();
					break;
				case 13:
					corso_inserisci_lezione();
					break;
				case 14:
					corso_modifica_lezione();
					break;
				case 15:
					corso_elimina_lezione();
					break;


				case 99:
					printf("\nINFO: Uscita...Bye\n");
					exit(0);
			}

		}
		
	}else printf("ERROR: Nome piscina non valido\n");
}


// ************************ ADDETTO COMUNALE ******************************
void piscina_inserisci(){
	char nome[50],indirizzo[30],telefono[20],responsabile[30],da[11],a[11];
	int tipo;

	printf ("\nNome della piscina: ");
	scanf ("%s",nome);
	fflush(stdin);
	printf ("\nIndirizzo della piscina : ");
	scanf ("%[^\n]",indirizzo);
	fflush(stdin);
	printf ("\nTelefono della piscina : ");
	scanf ("%[^\n]",telefono);
	fflush(stdin);
	printf ("\nResponsabile della piscina : ");
	scanf ("%[^\n]",responsabile);
	fflush(stdin);
	printf ("\nLa piscina ha la vasca all'aperto? 1=si,0=no: ");
	scanf ("%i",&tipo);
	fflush(stdin);

	if(tipo == 1){
		printf ("\nMese inizio disponibilità vasca all'aperto : ");
		scanf ("%[^\n]",da);
		fflush(stdin);

		printf ("\nMese fine disponibilità vasca all'aperto : ");
		scanf ("%[^\n]",a);
		fflush(stdin);

		snprintf(query, 1000, "\ncall piscina_inserisci('%s','%s','%s','%s','%i','%s','%s')",
					 nome, indirizzo, telefono, responsabile, tipo, da, a);
		run_sql_query(query);

	} else if(tipo == 0){
		snprintf(query, 1000, "\ncall piscina_inserisci('%s','%s','%s','%s','%i',NULL,NULL)",
					 nome, indirizzo, telefono, responsabile, tipo);
		run_sql_query(query);
	}
}


void piscina_modifica(){
	char nome[50],indirizzo[30],telefono[20],responsabile[30],da[11],a[11];
	int tipo;

	printf ("\nNuovo nome della piscina: ");
	scanf ("%s",nome);
	fflush(stdin);
	printf ("\nNuovo indirizzo della piscina : ");
	scanf ("%[^\n]",indirizzo);
	fflush(stdin);
	printf ("\nNuovo telefono della piscina : ");
	scanf ("%[^\n]",telefono);
	fflush(stdin);
	printf ("\nNuovo responsabile della piscina : ");
	scanf ("%[^\n]",responsabile);
	fflush(stdin);
	printf ("\nLa piscina ha la vasca all'aperto? 1=si,0=no: ");
	scanf ("%i",&tipo);
	fflush(stdin);

	if(tipo == 1){
		printf ("\nMese inizio disponibilità vasca all'aperto : ");
		scanf ("%[^\n]",da);
		fflush(stdin);

		printf ("\nMese fine disponibilità vasca all'aperto : ");
		scanf ("%[^\n]",a);
		fflush(stdin);

		snprintf(query, 1000, "\ncall piscina_modifica('%s','%s','%s','%s','%i','%s','%s')",
					 nome, indirizzo, telefono, responsabile, tipo, da, a);
		run_sql_query(query);

	} else if(tipo == 0){
		snprintf(query, 1000, "\ncall piscina_modifica('%s','%s','%s','%s','%i',NULL,NULL)",
					 nome, indirizzo, telefono, responsabile, tipo);
		run_sql_query(query);
	}
}

void piscina_elimina(){
	char nome[50];

	printf ("\nNome della piscina da eliminare: ");
	scanf ("%s",nome);
	fflush(stdin);
	
	snprintf(query, 1000, "\ncall piscina_elimina('%s')",nome);
	run_sql_query(query);
}


void insegnante_inserisci(){
	char CF_Ins[17],nome[30],telefono[20],cellulare[20];

	printf ("\nCodice fiscale dell'insegnante: ");
	scanf ("%s",CF_Ins);
	fflush(stdin);
	printf ("\nNome : ");
	scanf ("%[^\n]",nome);
	fflush(stdin);
	printf ("\nTelefono : ");
	scanf ("%[^\n]",telefono);
	fflush(stdin);
	printf ("\nCellulare : ");
	scanf ("%[^\n]",cellulare);
	fflush(stdin);

	snprintf(query, 1000, "\ncall insegnante_inserisci('%s','%s','%s','%s')",CF_Ins,nome,telefono,cellulare);
	run_sql_query(query);
}

void insegnante_modifica(){
	char CF_Ins[17],nome[30],telefono[20],cellulare[20];

	printf ("\nCodice fiscale dell'insegnante da modificare: ");
	scanf ("%s",CF_Ins);
	fflush(stdin);
	printf ("\nNuovo nome : ");
	scanf ("%[^\n]",nome);
	fflush(stdin);
	printf ("\nNuovo telefono : ");
	scanf ("%[^\n]",telefono);
	fflush(stdin);
	printf ("\nNuovo cellulare : ");
	scanf ("%[^\n]",cellulare);
	fflush(stdin);

	snprintf(query, 1000, "\ncall insegnante_modifica('%s','%s','%s','%s')",CF_Ins,nome,telefono,cellulare);
	run_sql_query(query);
}

void insegnante_elimina(){
	char CF_Ins[17];

	printf ("\nCodice fiscale dell'insegnante da modificare: ");
	scanf ("%s",CF_Ins);
	fflush(stdin);

	snprintf(query, 1000, "\ncall insegnante_elimina('%s')",CF_Ins);
	run_sql_query(query);
}


void qualifica_inserisci(){
	char nome[30];

	printf ("\nNome della qualifica: ");
	scanf ("%[^\n]",nome);
	

	snprintf(query, 1000, "\ncall qualifica_inserisci('%s')",nome);
	run_sql_query(query);
}

void qualifica_modifica(){
	char old_nome[30],new_nome[30];

	printf ("\nNome della qualifica da modificare: ");
	scanf ("%[^\n]",old_nome);
	fflush(stdin);
	printf ("\nNuovo nome della qualifica: ");
	scanf ("%[^\n]",new_nome);
	fflush(stdin);

	snprintf(query, 1000, "\ncall qualifica_modifica('%s','%s')",old_nome,new_nome);
	run_sql_query(query);
}

void qualifica_elimina(){
	char nome[30];

	printf ("\nNome della qualifica da eliminare: ");
	scanf ("%[^\n]",nome);
	fflush(stdin);

	snprintf(query, 1000, "\ncall qualifica_elimina('%s')",nome);
	run_sql_query(query);
}


void insegnante_assegna_qualifica(){
	char CodFisc_I[17],nome_qual[30];

	printf ("\nCodice fiscale dell'insegnante: ");
	scanf ("%s",CodFisc_I);
	fflush(stdin);

	printf ("\nNome della qualifica: ");
	scanf ("%[^\n]",nome_qual);
	fflush(stdin);

	snprintf(query, 1000, "\ncall insegnante_assegna_qualifica('%s','%s')",CodFisc_I,nome_qual);
	run_sql_query(query);
}

void insegnante_cancella_qualifica(){
	char CodFisc_I[17],nome_qual[30];

	printf ("\nCodice fiscale dell'insegnante: ");
	scanf ("%s",CodFisc_I);
	fflush(stdin);

	printf ("\nNome della qualifica da cancellare: ");
	scanf ("%[^\n]",nome_qual);
	fflush(stdin);

	snprintf(query, 1000, "\ncall insegnante_cancella_qualifica('%s','%s')",CodFisc_I,nome_qual);
	run_sql_query(query);
}

void rotazione_inserisci(){
	char CodFisc_I[17],piscina[50],inizio[11],fine[11];

	printf ("\nCodice fiscale dell'insegnante: ");
	scanf ("%s",CodFisc_I);
	fflush(stdin);
	printf ("\nNome della piscina : ");
	scanf ("%[^\n]",piscina);
	fflush(stdin);
	printf ("\nData inizio rotazione [AAAA-MM-GG]: ");
	scanf ("%s",inizio);
	fflush(stdin);
	printf ("\nData fine rotazione [AAAA-MM-GG]: ");
	scanf ("%s",fine);
	fflush(stdin);

	snprintf(query, 1000, "\ncall rotazione_inserisci('%s','%s','%s','%s')",inizio,fine,CodFisc_I,piscina);
	run_sql_query(query);
}

void rotazione_modifica(){
	char CodFisc_I[17],piscina[50],old_inizio[11],old_fine[11],new_inizio[11],new_fine[11];

	printf ("\nCodice fiscale dell'insegnante: ");
	scanf ("%s",CodFisc_I);
	fflush(stdin);
	printf ("\nNome della piscina : ");
	scanf ("%[^\n]",piscina);
	fflush(stdin);
	printf ("\nData inizio rotazione da modificare [AAAA-MM-GG]: ");
	scanf ("%s",old_inizio);
	fflush(stdin);
	printf ("\nData fine rotazione da modificare [AAAA-MM-GG]: ");
	scanf ("%s",old_fine);
	fflush(stdin);
	printf ("\nNuova data inizio rotazione [AAAA-MM-GG]: ");
	scanf ("%s",new_inizio);
	fflush(stdin);
	printf ("\nNuova data fine rotazione [AAAA-MM-GG]: ");
	scanf ("%s",new_fine);
	fflush(stdin);

	snprintf(query, 1000, "\ncall rotazione_modifica('%s','%s','%s','%s','%s','%s')",old_inizio,old_fine,CodFisc_I,piscina,new_inizio,new_fine);
	run_sql_query(query);
}

void rotazione_elimina(){
	char CodFisc_I[17],piscina[50],inizio[11],fine[11];

	printf ("\nCodice fiscale dell'insegnante: ");
	scanf ("%s",CodFisc_I);
	fflush(stdin);
	printf ("\nNome della piscina : ");
	scanf ("%[^\n]",piscina);
	fflush(stdin);
	printf ("\nData inizio rotazione da eliminare [AAAA-MM-GG]: ");
	scanf ("%s",inizio);
	fflush(stdin);
	printf ("\nData fine rotazione da eliminare [AAAA-MM-GG]: ");
	scanf ("%s",fine);
	fflush(stdin);

	snprintf(query, 1000, "\ncall rotazione_elimina('%s','%s','%s','%s')",inizio,fine,CodFisc_I,piscina);
	run_sql_query(query);
}


void addetto_comunale_logged(){
	printf("\n######################################\n");
	printf("INFO: Accesso eseguito come addetto comunale.\n\n");

	while(true){
		printf("\n#########################################################\n");
		printf(" Lista funzioni eseguibili dall'utente addetto comunale :\n");
		printf("##########################################################\n\n");
		printf("  1) Inserisci piscina\n");
		printf("  2) Modifica piscina\n");
		printf("  3) Elimina piscina\n\n");

		printf("  4) Inserisci insegnante\n");
		printf("  5) Modifica insegnante\n");
		printf("  6) Elimina insegnante\n\n");

		printf("  7) Inserisci qualifica\n");
		printf("  8) Modifica qualifica\n");
		printf("  9) Elimina qualifica\n\n");

		printf("  10) Assegna qualifica ad un insegnante\n");
		printf("  11) Cancella qualifica ad un insegnante\n\n");

		printf("  12) Inserisci rotazione insegnante\n");
		printf("  13) Modifica rotazione insegnante\n");
		printf("  14) Elimina rotazione insegnante\n\n");

		printf("  99) Termina\n\n");
		printf("> Inserisci un Comando: ");
		scanf ("%i",&cmd2);
		fflush(stdin);

		switch(cmd2){
			case 1:
				piscina_inserisci();
				break;
			case 2:
				piscina_modifica();
				break;
			case 3:
				piscina_elimina();
				break;
			case 4:
				insegnante_inserisci();
				break;
			case 5:
				insegnante_modifica();
				break;
			case 6:
				insegnante_elimina();
				break;
			case 7:
				qualifica_inserisci();
				break;
			case 8:
				qualifica_modifica();
				break;
			case 9:
				qualifica_elimina();
				break;
			case 10:
				insegnante_assegna_qualifica();
				break;
			case 11:
				insegnante_cancella_qualifica();
				break;
			case 12:
				rotazione_inserisci();
				break;
			case 13:
				rotazione_modifica();
				break;
			case 14:
				rotazione_elimina();
				break;



			case 99:
				printf("\nINFO: Uscita...Bye\n");
				exit(0);
		}

	}
}


// ************************ LOGIN ******************************

void login_f () {
	printf("\n########### Login ###########\n\n");
	printf("> Inserisci l'username: ");
	scanf("%s",u);
	printf("> Inserisci la password: ");
	scanf("%s",p);
	printf("\n\n");

	conn = mysql_init (NULL);
	login = mysql_real_connect(conn, "localhost",u,p, "temp-test", 3306, NULL, 0);

	if (login == NULL) {
		fprintf(stderr, "%s\n", mysql_error(conn));
		mysql_close(conn);
		exit(1);
	} else {
		printf ("\nINFO: Connessione riuscita\n");

		if (strcmp(u, "insegnante") == 0) {
			insegnante_logged();

		} else if (strcmp(u, "addetto_segreteria") == 0) {
			addetto_segreteria_logged();

		} else if (strcmp(u, "addetto_comunale") == 0) {
			addetto_comunale_logged();
		}

	}

	mysql_close(conn);
	exit(0);
}



int main (int argc, char *argv[]) {
	while (1) {
		printf("################### Gestione piscine comunali di Roma ###################\n\n");
		printf("  1) Login\n");
		printf("  99) Termina\n\n");
		printf("> Inserisci un Comando: ");
		scanf ("%i",&cmd1);
		fflush(stdin);
		if (cmd1 == 1) {
			login_f();
		} else if (cmd1 == 99) {
			printf("\nINFO: Uscita...Bye\n");
			exit(0);
		} 
	}
}



